%section#page-project
  %section#project-header
    .container
      .page-header
        .project-meta.clearfix
          .pull-left
            %span.created_at
              = image_tag 'icon_clock.png', class: 'icon-clock'
              %span.date= date_f @project.created_at
            %span.comments-button
              = image_tag 'icon_comment.png', class: 'icon-comment'
              %span.count= @project.comments.count
          .pull-right
            - share_partial = capture do
              - data = {action: 'toktok-share', 'share-url': project_url, 'share-text': "#{@project.title} || 시민의 제안으로 법안을 만듭니다. 지금 #국회톡톡에 참여해서 시민의 제안을 국회로 연결해주세요!"}
              - map = { facebook: data }
              - map.update twitter: data, 'kakao-link': data, 'kakao-story': data
              .share-box.clearfix
                - %w(facebook twitter kakao-link kakao-story).each do |provider|
                  - data = map[provider.to_sym].merge('share-provider': provider)
                  - if provider == 'kakao-link'
                    - hide_kakao_link = (! browser.device.mobile?) ? ' hide' : ''
                    - data = data.merge('share-image': "icon_comment.png", 'share-image-width': '300', 'share-image-height': '158') if @project.image
                  %span.pull-left{class: "share-item share-#{provider}#{hide_kakao_link}", data: data }
                    - if provider == 'kakao-story'
                      = image_tag 'icon_kas.png', class: 'icon-kas'
            %span.share-button{"data-url": "#share-partial-#{dom_id(@project)}", "data-action": "toktok-popover", "data-placement": "left"}
              %span.count= image_tag 'icon_share.png', class: 'icon-share'
            .hidden
              .share-partial{id: "share-partial-#{dom_id(@project)}"}
                = share_partial
            - if current_user.try(:role).try(:staff?)
              %span.admin-button
                = link_to admin_project_path(@project) do
                  %i.fa.fa-cog
                  관리
        %h2
          = @project.title

      .project-panel__intro.project-panel
        .project-image
          %img{src: @project.image.lg.url}
        .project-panel__status.project-panel
          .project-status-bar
            .steps{class: "steps--#{@project.status}"}<>
              .step.step--gathering<>
                = t("messages.project_status.gathering")
              .step.step--matching<>
                = t("messages.project_status.matching")
              .step.step--running<>
                = t("messages.project_status.running")
        .project-panel__body
          != @project.body
        - @project.attachments.each do |attachment|
          = link_to attachment.name, attachment.source.url, target: '_blank'

  %section#project-meta
    .container
      - if @project.proposal.present?
        %hr.project-divider
        .project-panel__proposer.project-panel
          .project-label
            %strong|
            제안자
          .project-panel__proposer
            .media
              .media-left
                .proposer-image.img-user-large{style: "background-image: url(#{@project.proposal.proposer_image_url(:sm)});"}
              .media-body.proposal-content
                %span.proposer-name
                  = @project.proposal.proposer_name
                %span.proposer-date
                  = static_date_f_not_hour @project.proposal.created_at
                .proposer-opinion
                  = simple_format @project.proposer_description

  - unless @project.participant?(current_user)
    %section#project-participations-stuckable
      .container
        .project-panel__participation.project-panel
          .btn-project-participation#project-participation-button-stuckable
            = render 'participations/button', project: @project

  %section#project-participations
    .container
      .project-panel__participation.project-panel
        %p.participation-title
          - unless @project.participant?(current_user)
            - if @project.participations.any?
              이 제안에 #{@project.participations_count + 1}번째 참여시민이 되어 보세요!
            - else
              이 제안에 첫 번째 참여시민이 되어 보세요!
          - else
            #{current_user.nickname}님은 제안에 참여 중이십니다.
        .participation-progress
          .participation-progress__graph
            - left_style = "left: #{@project.participations_percentage - 5}%" if @project.participations_percentage > 5 and @project.participations_percentage <= 90
            - right_style = "float: right;" if @project.participations_percentage > 90
            .current-participations-count.clearfix
              .content{style: "#{left_style} #{right_style}"}
                참여
                %span
                  %span.count<>= @project.participations_count
                  명
                %br
                %i.fa.fa-bullhorn
            - if @project.participations_percentage >= 100
              .bar
                .participations-bar{style: "width: 100%"}
            - else
              .bar
                .participations-bar{style: "width: #{@project.participations_percentage}%"}

              .participations-goal-count
                목표 #{@project.participations_goal_count}명

        .btn-project-participation#project-participation-button
          = render 'participations/button', project: @project
        .participation-users
          = render 'participations/list', project: @project

  %section#comments
    .container
      - if @project.committee.present?
        .project-panel__committee.project-panel
          .project-label
            %strong|
            관련 상임위원회
          .committee-content
            .committee-name
              = @project.committee.name
            .committee-congressmen.owl-carousel
              - @project.committee.congressmen.each do |congressman|
                .committee-congressman-wrapper
                  .committee-congressman
                    - unless @project.status == :gathering
                      .committee-congressman__status{class: "committee-congressman__status--#{@project.status_of_congressman(congressman)}"}
                        = t("enumerize.match.status.#{@project.status_of_congressman(congressman)}")
                    .committee-congressman__image.img-cogressman{style: "background-image: url(#{congressman.image.sm.url})"}
                    .committee-congressman__name
                      = congressman.name
                    .committee-congressman__contacts
                      .committee-congressman__contacts--tok
                        %a.action-mention.btn{ href: '#', data: { mention: { to: congressman.name, 'form-control': '#new_comment textarea#comment_body', 'form-placeholder': '.placeholder.action-show' } } }
                          톡톡
                          = image_tag 'icon_comment_white.png', class:'tok-icon'
                      - if congressman.twitter_url.present?
                        .committee-congressman__contacts--twitter
                          = link_to congressman.twitter_url, target: '_blank' do
                            %i.fa.fa-twitter.fa-fw
                      - if congressman.facebook_url.present?
                        .committee-congressman__contacts--facebook
                          = link_to congressman.facebook_url, target: '_blank' do
                            %i.fa.fa-facebook.fa-fw
      .project-panel__comments.project-panel
        %hr.project-divider
        .project-label
          %strong|
          참여시민 톡톡
          %span.text-muted (#{@project.comments.count})
      = render 'comments/list', commentable: @project, placeholder: '의견을 남겨주세요.'
